name: Cleanup TrueNAS Artifacts

on:
  workflow_dispatch: # Manual trigger only

jobs:
  cleanup:
    name: Clean up TrueNAS test artifacts
    runs-on: self-hosted
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v6
      
      - name: Set up Go
        uses: actions/setup-go@v6
        with:
          go-version: '1.25'
      
      - name: Run TrueNAS cleanup
        env:
          TRUENAS_HOST: ${{ secrets.TRUENAS_HOST }}
          TRUENAS_API_KEY: ${{ secrets.TRUENAS_API_KEY }}
          TRUENAS_POOL: ${{ secrets.TRUENAS_POOL }}
        run: |
          ./scripts/cleanup-truenas-artifacts.sh
