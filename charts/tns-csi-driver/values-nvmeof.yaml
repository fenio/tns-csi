# Example values for NVMe-oF deployment
# This configuration creates a TrueNAS CSI driver with NVMe-oF support
# NOTE: NVMe-oF requires Linux kernel modules (nvme-tcp) on worker nodes

# IMPORTANT: Before deploying, ensure you have configured an NVMe-oF port
# in TrueNAS (Shares > NVMe-oF Targets > Ports). The CSI driver automatically
# creates a dedicated subsystem for each volume - no pre-configured subsystem needed.

truenas:
  # Your TrueNAS server configuration
  host: "YOUR-TRUENAS-IP"
  port: 443
  apiKey: "your-api-key-here"
  allowInsecure: true
  
  # Base dataset where volumes will be created
  baseDataset: "tank/k8s-volumes"

# Storage class configuration - NVMe-oF
storageClasses:
  - name: truenas-nvmeof
    protocol: nvmeof
    reclaimPolicy: Delete
    allowVolumeExpansion: true
    volumeBindingMode: WaitForFirstConsumer
    parameters:
      # NVMe-oF specific parameters
      transport: "tcp"
      # Optional: specify portal IP if different from truenas.host
      # portal: "YOUR-TRUENAS-IP"

# Optional: Also include NFS for mixed workloads
  - name: truenas-nfs
    protocol: nfs
    reclaimPolicy: Delete
    allowVolumeExpansion: true
    volumeBindingMode: Immediate
    mountOptions:
      - hard
      - nfsvers=4.1
      - noatime

# Resource limits optimized for block storage workloads
controller:
  replicaCount: 1
  resources:
    limits:
      cpu: 300m
      memory: 512Mi
    requests:
      cpu: 150m
      memory: 256Mi

node:
  resources:
    limits:
      cpu: 300m
      memory: 512Mi
    requests:
      cpu: 150m
      memory: 256Mi

# Security context - NVMe-oF requires elevated privileges
securityContext:
  privileged: true
  allowPrivilegeEscalation: true
  capabilities:
    add:
      - SYS_ADMIN
      - SYS_MODULE  # For loading kernel modules

# Node affinity to ensure nodes have required kernel modules
nodeSelector: {}
  # Example: Only schedule on nodes with NVMe support
  # storage.truenas.io/nvme: "true"

tolerations: []
  # Example: Tolerate storage-specific taints
  # - key: "storage-node"
  #   operator: "Exists"
  #   effect: "NoSchedule"
